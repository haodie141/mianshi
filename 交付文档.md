# 交付一

用户表主键 ID 由 Django 自动递增生成，登录名 username 全局唯一，密码采用 Django 默认的 PBKDF2 加密存储。套餐字段 plan 记录 free 或 pro，用于区分是否 Pro 用户；创建时间取自 date_joined，最后一次登录时间由 last_login 维护，是否超级管理员沿用内置 is_superuser 字段。

角色表主键 ID 自增，角色名 name 唯一；通过多对多字段 permissions 与权限表关联，创建与更新时间可在模型层通过 auto_now_add 与 auto_now 自动写入。

权限表主键 ID 自增，code 字段保存权限代号（如 case:delete），name 字段供人类阅读；创建与更新时间同样由模型自动维护。当前未设置「是否 Pro」布尔列，免费/Pro 区分通过 code 字符串前缀或角色命名约定实现，后续如需物理字段可平滑追加。

用户与角色关系由 Django 自动生成的中间表 rbac_user_roles 承载，内含 user_id 与 role_id 两外键，可额外增加时间戳字段以记录授权时刻。

角色与权限关系表 rbac_role_permissions 亦为 Django 默认中间表，含 role_id 与 permission_id 外键，创建与更新时间可自动记录；「是否 Pro」逻辑目前由权限 code 控制，无需额外编号字段，扩展时可直接在 Permission 模型追加 is_pro 布尔列并迁移。



# 交付二

### 2.1 用户认证

**POST /api/login/**

- 功能：用户登录
- 参数：username, password
- 返回：用户基本信息 + 角色列表

> 当前实现：Gradio 登录框（`gradio_ui/app.py`）调用 Django `authenticate()`，认证成功后进入主界面；角色列表通过「权限查看」页签获取。

**POST /api/register/**

- 功能：用户注册
- 参数：username, password
- 返回：注册结果

> 当前实现：未开放公开注册，需管理员在 Django-Admin 或执行 `createsuperuser` 添加账号。

### 2.2 用户管理

**GET /api/users/**

- 功能：获取所有用户（仅管理员可见）
- 返回：用户列表（含角色信息）

> 当前实现：Gradio「成员分配」下拉框实时列出 `User.objects.all()`，等价此接口。

**GET /api/users/{id}/**

- 功能：获取单个用户信息
- 返回：用户详情

> 当前实现：在 Gradio 选择用户后点击「查询权限」，即返回该用户拥有的角色及权限列表，等价此接口。

### 2.3 角色管理

**GET /api/roles/**

- 功能：获取所有角色
- 返回：角色列表

> 当前实现：Gradio「角色管理」与「成员分配」页签均通过 `Role.objects.all()` 加载，等价此接口。

**POST /api/users/{id}/roles/**

- 功能：为用户分配角色
- 参数：role_id

> 当前实现：Gradio「成员分配」勾选角色后点击「更新角色」，后台执行 `user.roles.set([role])`，等价此接口。



# 交付三

## 3.1

继承：单向的，明确声明的

颗粒度：过粗的颗粒度无法满足一些精细的需求，过细的颗粒度又会浪费资源

## 3.2

超级管理员问题：所有管理员操作行为都应该被记录下来，如果有误操作可以通过回溯找回。管理员的身份是相对的，可以被撤销

并发修改权限：类似于git操作，当多个修改同时操作时，应该记录下各自的修改而不是覆盖他人的

## 3.3

对已知的，经常出现的权限放在缓存里，不用每次都调用数据库查询

比如登录访问这些简单的操作，就可以放在缓存里